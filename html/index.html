<!DOCTYPE=html>
<head>
  <title>Blackjack</title>
  <link rel="stylesheet" href="../css/site.css">
</head>
<body>
  <button id="newGameButton">New Game</button>

  <button id="hitMeButton">Hit Me</button>
  <button id="stayButton">Stay</button>

  <div id="score"></div>

  <div id="dealer">
    <p>Dealer</p>
    <div id="back" class="card"></div>
    <div id="empty" class="card"></div>
  </div>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <br>
  <div id="player">
    <p>Player</p>
    <div id="back" class="card"></div>
    <div id="empty" class="card"></div>
  </div>

  <script type="text/javascript" src="../js/blackjack.js"></script>
  <script type="text/javascript">
    // I kept this out of the blackjack.js file to separate the view from the controller,
    // and to make testing easier

    var game = new Game();
    var player = new Player();
    var dealer = new Player();

    var playerCardsOnScreen = document.getElementById("player");

    /*Set up event listeners for buttons*/
    var newGameButton = document.getElementById("newGameButton");
    var hitMeButton = document.getElementById("hitMeButton");
    var stayButton = document.getElementById("stayButton");

    newGameButton.addEventListener('click', function() {
      startNewGame();
    }, false);

    hitMeButton.addEventListener('click', function() {
      hitMe();
    }, false);

    stayButton.addEventListener('click', function() {
      alert('you stayed');
    }, false);

    // Game functions that should probably go in the other file.
    function startNewGame(){
      // Initialize the game and one player, then build the deck

      var score = document.getElementById("score");
      score.innerHTML = player.score;

      game.shuffleCards();
      player.cards = [];
      dealer.cards = [];

      game.dealCard(player, 2);
      game.dealCard(dealer, 2);

      for(var index in player.cards){
        var card = player.cards[index];
        var cardBox = playerCardsOnScreen.getElementsByTagName("div")[index];
        cardBox.id = card.name;
        cardBox.style.backgroundImage = "url(../img/cards/" + card.name + ".png)";
      }

      setTimeout(function(){
        var playerScore = game.checkScore(player);
        var dealerScore = game.checkScore(dealer);

        if(playerScore > 21){
          alert("Busted! You're over 21!");
        } else if(dealerScore > 21){
          alert("Dealer loses! You win!");
        }
      }, 300);


    }

    function hitMe(){
      game.dealCard(player, 1);
      var card = player.cards[player.cards.length-1];
      var newCard = document.createElement("div");
      newCard.className = "card";
      newCard.id = card.name;
      newCard.style.backgroundImage = "url(../img/cards/" + card.name + ".png)";
      playerCardsOnScreen.appendChild(newCard);

      setTimeout(function(){
        game.checkScore(player);
        game.checkScore(dealer);
      }, 300);
    }

    startNewGame();

  </script>

</body>
</html>
